
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta name="baidu-site-verification" content="EXHJyZtvnK" />
  <meta name="google-site-verification" content="6RGq-UvXNfWc80Du2Skb0Wek28STlwShTWc2W0svf90" />
  <meta charset="UTF-8">
  
    <title>程序员常见的编码和转义 | 懒程序员改变世界</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Qinghua Gao">
    

    
    <meta name="description" content="作为一名天朝程序员，除了看惯了乱码之外，在日常的工作中经常会碰到编码和转义。如果能掌握这块领域的一些常识，就可以在开发和支持时游刃有余。">
<meta name="keywords" content="encoding">
<meta property="og:type" content="article">
<meta property="og:title" content="程序员常见的编码和转义">
<meta property="og:url" content="http://qinghua.github.io/encoding-and-escaping/index.html">
<meta property="og:site_name" content="懒程序员改变世界">
<meta property="og:description" content="作为一名天朝程序员，除了看惯了乱码之外，在日常的工作中经常会碰到编码和转义。如果能掌握这块领域的一些常识，就可以在开发和支持时游刃有余。">
<meta property="og:image" content="http://qinghua.github.io/img/sublime-text-encoding.png">
<meta property="og:image" content="http://qinghua.github.io/img/intellij-idea-encoding.jpg">
<meta property="og:image" content="http://www.json.org/string.gif">
<meta property="og:updated_time" content="2016-12-23T15:37:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员常见的编码和转义">
<meta name="twitter:description" content="作为一名天朝程序员，除了看惯了乱码之外，在日常的工作中经常会碰到编码和转义。如果能掌握这块领域的一些常识，就可以在开发和支持时游刃有余。">
<meta name="twitter:image" content="http://qinghua.github.io/img/sublime-text-encoding.png">

    
    <link rel="alternative" href="/atom.xml" title="懒程序员改变世界" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="懒程序员改变世界" title="懒程序员改变世界"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="懒程序员改变世界">懒程序员改变世界</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<!--form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form-->
<script>
  (function() {
    var cx = "002339689071915007017:ri31kjwxfkg";
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/encoding-and-escaping/" title="程序员常见的编码和转义" itemprop="url">程序员常见的编码和转义</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Qinghua Gao" target="_blank" itemprop="author">Qinghua Gao</a>
		
  <p class="article-time">
    <time datetime="2016-11-06T01:53:09.000Z" itemprop="datePublished"> 发表于 2016-11-06</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编码（encoding）"><span class="toc-number">1.</span> <span class="toc-text">编码（encoding）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ASCII-amp-EASCII-amp-ISO-8859-1"><span class="toc-number">1.1.</span> <span class="toc-text">ASCII & EASCII & ISO-8859-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GB2312-amp-GBK-amp-GB18030-amp-ANSI"><span class="toc-number">1.2.</span> <span class="toc-text">GB2312 & GBK & GB18030 & ANSI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-amp-UTF-8"><span class="toc-number">1.3.</span> <span class="toc-text">Unicode & UTF-8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base64-amp-UTF-7"><span class="toc-number">1.4.</span> <span class="toc-text">base64 & UTF-7</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转义（escaping）"><span class="toc-number">2.</span> <span class="toc-text">转义（escaping）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#html-amp-url"><span class="toc-number">2.1.</span> <span class="toc-text">html & url</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML-amp-YAML-amp-JSON-amp-CSV"><span class="toc-number">2.2.</span> <span class="toc-text">XML & YAML & JSON & CSV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-amp-NET-amp-JS-amp-SQL"><span class="toc-number">2.3.</span> <span class="toc-text">Java & .NET & JS & SQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">3.</span> <span class="toc-text">后记</span></a></li></ol>
		
		</div>
		
		<p>作为一名天朝程序员，除了看惯了乱码之外，在日常的工作中经常会碰到编码和转义。如果能掌握这块领域的一些常识，就可以在开发和支持时游刃有余。<br><a id="more"></a></p>
<h2 id="编码（encoding）"><a href="#编码（encoding）" class="headerlink" title="编码（encoding）"></a>编码（encoding）</h2><h3 id="ASCII-amp-EASCII-amp-ISO-8859-1"><a href="#ASCII-amp-EASCII-amp-ISO-8859-1" class="headerlink" title="ASCII &amp; EASCII &amp; ISO-8859-1"></a>ASCII &amp; EASCII &amp; ISO-8859-1</h3><p>要聊编码，就需要从ASCII开始。众所周知，计算机的世界里，数据都是0和1这样的二进制。用它们的组合来表示字母、数字和常用符号的最通用编码标准就是<a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="external">ASCII</a>（American Standard Code for Information Interchange，美国信息交换标准代码）。完整的ASCII编码可以从<a href="http://www.ascii-code.com/" target="_blank" rel="external">这里</a>找到。Mac或Linux可以用以下命令来查看所有的ASCII字符：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">man ascii</div></pre></td></tr></table></figure></p>
<p>其中，<code>00000000</code>到<code>00011111</code>的前32位字符和<code>01111111</code>是控制字符，<code>00100000</code>到<code>01111110</code>之间的都是可显示字符，一个字符占8位（bit），第1位总是<code>0</code>，这样能够支持2的7次方即128个符号编码。虽然ASCII编码能搞定美国大多数的应用场景，但是对于其它发达国家的语言来说就无能为力了。于是在其上发展出了<a href="https://zh.wikipedia.org/wiki/EASCII" target="_blank" rel="external">EASCII</a>（extended ASCII），通过扩展最前面的一位为<code>1</code>来提供多达256个符号编码的支持。可是这样又带来了两个问题：一来即使是256个编码，对于世界范围尤其是像中日这样的汉字国家来说还是远远不够；二来各个国家规定的EASCII编码都不一样，比如对于希腊来说EASCII表示的就是希腊字母，而对于法国来说可能就是某个带有注音符号的字母。这样的背景下，ISO（International Standard Organization，国际标准化组织）设计了<a href="https://zh.wikipedia.org/wiki/ISO/IEC_8859" target="_blank" rel="external">ISO/IEC 8859</a>字符集（不包含ASCII），力图一统拉丁语系。其实现的编码表<a href="https://zh.wikipedia.org/wiki/ISO_8859-1" target="_blank" rel="external">ISO-8859-1</a>（包含ASCII）应用得非常广泛。</p>
<h3 id="GB2312-amp-GBK-amp-GB18030-amp-ANSI"><a href="#GB2312-amp-GBK-amp-GB18030-amp-ANSI" class="headerlink" title="GB2312 &amp; GBK &amp; GB18030 &amp; ANSI"></a>GB2312 &amp; GBK &amp; GB18030 &amp; ANSI</h3><p>本节介绍的是解决EASCII带来的第一个问题的方法。对于中文来说，8位的编码远远不够，于是就会想到用两个8位来表示一个汉字。为了与ASCII码兼容，如果碰到0~127的字符，需要认定为ASCII编码字符。只有当两个大于127的字符连在一起时，才表示一个汉字。前一个字符称为高字节，后一个称为低字节，这样就诞生了<a href="https://zh.wikipedia.org/wiki/GB_2312" target="_blank" rel="external">GB2312</a>编码。每一个双字节字符就称为一个全角字符，而单字节字符就称为半角字符。再后来，发现编码还是不够用，干脆就允许低字节也使用0~127的字符，反正用高字节就能判断是否是汉字，这样就诞生了<a href="https://zh.wikipedia.org/wiki/GBK" target="_blank" rel="external">GBK</a>（K表示“扩展”）编码。GBK里甚至还包含了日语的假名和俄语字母。GB2312和GBK这两种编码都是单字节（表示ASCII）和双字节（表示汉字）混合使用的编码。我国最新的汉字编码国标是<a href="https://zh.wikipedia.org/wiki/GB_18030" target="_blank" rel="external">GB18030</a>，这是一种类似下文UTF-8那样的变长编码。</p>
<p>虽然中国解决了中文问题，但是世界各国都搞出了一套自己的编码系统，还是不能轻易相互转化。例如台湾用BIG5，日本用Shift-JIS。要想解决EASCII的第二个问题，还需要另寻他途。Window系统的记事本里，默认编码为ANSI，即根据系统语言的不同，而选用不同的编码。</p>
<h3 id="Unicode-amp-UTF-8"><a href="#Unicode-amp-UTF-8" class="headerlink" title="Unicode &amp; UTF-8"></a>Unicode &amp; UTF-8</h3><p>本节说的是解决EASCII带来的第二个问题的方法。ISO带来了一个囊括全球所有文字的编码：Unicode。它最初规定了所有的字符（包括ASCII）都使用两个字节来表示，这个版本称为<a href="https://zh.wikipedia.org/wiki/UCS-2" target="_blank" rel="external">UCS-2</a>（Universal Multiple-Octet Coded Character Set）或UTF-16。对于ASCII码来说，在它的前面加上<code>00000000</code>作为高字节即可。这样的好处是，由于高低字节可以同时包含0~256，能表示的字符数量就更多了，理论上可以达到256×256=65536个。即使如此，也只能说是基本上够用，要囊括所有文明的文字，还需要更多的字节。目前最多支持4个字节代表一个字符，称为<a href="https://zh.wikipedia.org/wiki/UCS-4" target="_blank" rel="external">UCS-4</a>或UTF-32，它的最高位规定必须为0，可以表示65536×65536÷2=2147483648个字符（这样是不是统一银河系也够用了）。与此同时，它包含的字符集也在不断的增加，甚至收录了<a href="https://zh.wikipedia.org/wiki/%E7%B9%AA%E6%96%87%E5%AD%97" target="_blank" rel="external">emoji</a>（绘文字），大大增加了文字符号的表现力，看看😂🐔📸🎸🎁🌀🌤🕘，是不是增加了很多乐趣呢。</p>
<p>Unicode就像是“书同文、车同轨”，极大地方便了各国的交流。可是它也有自身的缺点。一个问题是它与各国自身的标准不兼容（例如GB18030），但是这个问题貌似无解，因为各国的标准本来就是排斥的。另一个问题是随着Unicode标准的发展，出现了4个字节的字符。但是当设计Java的时候，是<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#unicode" target="_blank" rel="external">将unicode当做2个字节的定长字符来看待</a>的。这样就导致Java里需要用两个char来表示一个4字节的字符，如emoji（😂=\uD83D\uDE02）。<a href="http://www.oracle.com/technetwork/articles/javase/index-zh-cn-138452.html" target="_blank" rel="external">Java平台中的增补字符</a>就是Oracle官方写来专门解决长字节Unicode的。打开链接就会看到一堆的乱码，说明编码问题还真是普遍存在并难以解决的啊。好在还有<a href="http://www.oracle.com/technetwork/articles/javase/index-142761.html" target="_blank" rel="external">英文版</a>可供阅读。还有一个问题就是对于英文来说，用高字节为固定值的两个字节来保存数据，就会使原来一个字节的数据量翻倍，对于传输和存储来说都是较大负担。</p>
<p>解决上面这个问题的办法就是UTF-8。它是一种变长的编码方式。如果是ASCII码的字符，就用一个字节表示。否则就在前面增加一个高位字节（但是在8个bit之内）。这回英文符号是满意了，但是中文字符可能就会因为增加的高位字节从Unicode的占用两个字节变成UTF-8的占用三个字节。没有两全其美的事啊！这也是为什么GB2312和GBK今天仍被广泛使用的原因之一，我们也不想增加传输和存储的负担呀。</p>
<p>如果要打开一个文本文件，首先需要知道它的编码。位于文件头的<a href="https://zh.wikipedia.org/wiki/%E4%BD%8D%E5%85%83%E7%B5%84%E9%A0%86%E5%BA%8F%E8%A8%98%E8%99%9F" target="_blank" rel="external">BOM</a>（Byte order mark，字节顺序标记）可以用来标记文件的编码类型。它分为<a href="https://en.wikipedia.org/wiki/Endianness#Big-endian" target="_blank" rel="external">BE</a>（big-endian，大端序）和<a href="https://en.wikipedia.org/wiki/Endianness#Little-endian" target="_blank" rel="external">LE</a>（little-endian，小端序），指的是高字节的位置在前还是在后。但是在类Unix系统中，它很可能因为无法被程序识别而带来一系列问题。所以一般的纯文本文件还是建议保存为不带BOM形式的编码。Window系统的记事本里，如果输入<code>联通</code>保存，便会将其保存为无BOM的GB格式，再次用记事本打开此文件时，因为没有BOM信息，记事本就需要自己推断这个文件的编码是什么。显然window是上这个推断很有问题，误认为是UTF-8格式（可以从文件菜单里的“另存为”看出来）。而mac上默认的文本编辑表现还是不错的。如果用word来打开它，便可以在一系列的编码中，自行寻找合适的编码来打开。如果用记事本另存为UTF-8格式，便不会有问题。Sublime Text可以支持用许多不同的编码来打开或是保存，光是UTF系列的就不少，如下图：<br><img src="/img/sublime-text-encoding.png" alt="sublime-text-encoding"></p>
<p>对于Java来说，内部的String编码默认为UTF-16，但如果由于用不着而觉得浪费内存的话，可以在JVM打开<code>-XX:+UseCompressedStrings</code>，就会变成ISO-8859-1了。Intellij IDEA的Preference里，有两个关于encoding的选项：<br><img src="/img/intellij-idea-encoding.jpg" alt="Intellij-IDEA-encoding"></p>
<p>可以通过Project Encoding来指定项目的JVM里String的内部编码，默认为UTF-8。可以通过下面这两个表达式来看到，它们的编码是完全一致的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"懒"</span>.getBytes()</div><div class="line"><span class="string">"懒"</span>.getBytes(<span class="string">"UTF-8"</span>)</div></pre></td></tr></table></figure></p>
<p>Java里可以用Integer.toHexString来看到汉字的unicode编码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">System.out.println(<span class="string">"\\u"</span> + Integer.toHexString(<span class="string">'懒'</span>));</div><div class="line">System.out.println(<span class="string">"\u61d2"</span>);</div></pre></td></tr></table></figure></p>
<p>通过下面的语句，可以将字节数组byte[]还原为原先的字符串。如果指定错了编码，就会看到乱码产生啦：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">System.out.println(<span class="keyword">new</span> String(<span class="string">"懒"</span>.getBytes(<span class="string">"UTF-8"</span>), <span class="string">"UTF-8"</span>));  <span class="comment">// 正常</span></div><div class="line">System.out.println(<span class="keyword">new</span> String(<span class="string">"懒"</span>.getBytes(<span class="string">"UTF-8"</span>), <span class="string">"UTF-16"</span>)); <span class="comment">// 乱码:�</span></div><div class="line">System.out.println(<span class="keyword">new</span> String(<span class="string">"懒"</span>.getBytes(<span class="string">"UTF-16"</span>), <span class="string">"UTF-8"</span>)); <span class="comment">// 乱码:��a�</span></div></pre></td></tr></table></figure></p>
<p>读文件、流也是一样的道理，知道了它们的编码才能正确地读取，否则只好像微软的记事本那样去猜啦。Java还提供了一个小工具<code>native2ascii</code>，可以把本地编码的文件转换为各种格式：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> 懒程序员 &gt; ggg.txt</div><div class="line">native2ascii -encoding UTF-8 ggg.txt out.txt</div><div class="line">cat out.txt</div><div class="line">native2ascii -reverse -encoding UTF-8 out.txt</div></pre></td></tr></table></figure></p>
<h3 id="base64-amp-UTF-7"><a href="#base64-amp-UTF-7" class="headerlink" title="base64 &amp; UTF-7"></a>base64 &amp; UTF-7</h3><p><a href="https://zh.wikipedia.org/zh-hans/Base64" target="_blank" rel="external">Base64</a>是一种在网络上传递信息时常见的编码。它相当于是一张64条记录的映射表，键从<code>000000</code>到<code>111111</code>，值就是64个不同的字符。编码时，如果原字符的bit数正好能被6整除，那就查表得到每6个bit所对应的值，合起来就是base64编码的结果。如果不能被6整除，那就在末尾用0补足。每补两个0，就在最终结果的后面加一个<code>=</code>号。所以如果一段数据以等号结尾，那十有八九就是base64编码。Mac或Linux可以用以下命令来进行base64编码及解码：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> -n A | base64</div><div class="line"><span class="built_in">echo</span> -n AB | base64</div><div class="line"><span class="built_in">echo</span> -n ABC | base64</div><div class="line"><span class="built_in">echo</span> -n QQ== | base64 --decode</div><div class="line"><span class="built_in">echo</span> -n QUI= | base64 --decode</div><div class="line"><span class="built_in">echo</span> -n QUJD | base64 --decode</div></pre></td></tr></table></figure></p>
<p>JavaScript可以用以下命令来进行base64编码及解码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.btoa(<span class="string">"A"</span>)</div><div class="line"><span class="built_in">window</span>.atob(<span class="string">"QQ=="</span>)</div></pre></td></tr></table></figure></p>
<p><a href="https://zh.wikipedia.org/wiki/UTF-7" target="_blank" rel="external">UTF-7</a>理论上也属于一种base64编码，只不过它的64行映射表不一样罢了。过去的SMTP协议仅能接受7个bit（ASCII）的字符，Unicode无法直接传输。所以通过UTF-7编码的方式，将Unicode字符转换为7个bit以内的字符。UTF-7本身并不是Unicode的标准，现在也已经由于邮件和传输都支持UTF-8而退出历史舞台了。</p>
<p>写到这里感觉得收一下了，不然MD5、SHA什么的都要出来了。对散列、加密有兴趣的童鞋们可以参考我以前写的另一篇文章<a href="http://qinghua.github.io/certificate/">《证书的那些事儿》</a>。</p>
<h2 id="转义（escaping）"><a href="#转义（escaping）" class="headerlink" title="转义（escaping）"></a>转义（escaping）</h2><h3 id="html-amp-url"><a href="#html-amp-url" class="headerlink" title="html &amp; url"></a>html &amp; url</h3><p>下面说说转义，不少人都把它与编码混而一谈，以至于它也算作编码的一部分了。从最简单的html聊起吧。在html里，如果只写上一些文本，那当我们用浏览器打开这个html时，就会完完整整地显示这些文本的内容。我们也知道，html里无论输入多少个空格，只会显示一个空格。因为在html里，把空格当成了特殊字符。在这种情况下，如果想要在html里放上空格，就需要对空格编码，也就是大家熟知的<code>&amp;nbsp;</code>。其中nbsp大名唤作Non-Breaking Space（<a href="https://zh.wikipedia.org/wiki/%E4%B8%8D%E6%8D%A2%E8%A1%8C%E7%A9%BA%E6%A0%BC" target="_blank" rel="external">不换行空格</a>），除了名字以外，它也有自己的编码：<code>&amp;#160;</code>。除了空格，常见的还有代表标签的<code>&lt;</code>和<code>&gt;</code>。完整的html转义可以从<a href="http://www.ascii.cl/htmlcodes.htm" target="_blank" rel="external">这里</a>找到。奇怪的是这么常用的转义，js居然没有原生的函数支持。如果要转义<code>&lt;div&gt;</code>，可以使用下面这条语句来得到<code>&amp;lt;div&amp;gt;</code>：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEncode</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.createElement(<span class="string">'a'</span>).appendChild(<span class="built_in">document</span>.createTextNode(html)).parentNode.innerHTML;</div><div class="line">&#125;;</div><div class="line">htmlEncode(<span class="string">'&lt;div&gt;'</span>);</div></pre></td></tr></table></figure></p>
<p>解码的话，这样做：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlDecode</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</div><div class="line">    a.innerHTML = html;</div><div class="line">    <span class="keyword">return</span> a.textContent;</div><div class="line">&#125;;</div><div class="line">htmlDecode(<span class="string">'&amp;lt;div&amp;gt;'</span>);</div></pre></td></tr></table></figure></p>
<p>如果使用jQuery，思路一致，但是代码可以稍微短一点：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEncode</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;div/&gt;'</span>).text(value).html();</div><div class="line">&#125;</div><div class="line">htmlEncode(<span class="string">'&lt;div&gt;'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlDecode</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;div/&gt;'</span>).html(value).text();</div><div class="line">&#125;</div><div class="line">htmlDecode(<span class="string">'&amp;lt;div&amp;gt;'</span>);</div></pre></td></tr></table></figure></p>
<p>可惜的是上面的函数并不能解决空格和<code>&amp;nbsp;</code>之间的转换。想要个万能的？也许只好使用replace一个个地慢慢替换了。</p>
<p>想要请求一个html，需要先输入一个url。这里就涉及到了url转义。因为url里可能会有类似<code>?name=ggg</code>这样的参数，所以起码就需要对<code>?</code>和<code>=</code>进行转义。转义之后分别为<code>%3F</code>和<code>%3D</code>，这与ASCII码是相对应的。完整的url编码可以从<a href="http://www.w3school.com.cn/tags/html_ref_urlencode.html" target="_blank" rel="external">这里</a>找到。这回js终于有原生的函数支持了：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">encodeURI</span>(<span class="string">'http://qinghua.github.io?name=g gg'</span>);</div><div class="line"><span class="built_in">encodeURIComponent</span>(<span class="string">'http://qinghua.github.io?name=g gg'</span>);</div></pre></td></tr></table></figure></p>
<p>用<code>encodeURI</code>函数的网址，不会去碰<code>http://</code>，所以编码后还是一个合法的网址。而<code>encodeURIComponent</code>会将一切都进行编码，网址也就不是网址了。不过它很适合将网址作为参数来使用。解码的话，这样做：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">decodeURI</span>(<span class="string">'http://qinghua.github.io?name=g%20gg'</span>);</div><div class="line"><span class="built_in">decodeURIComponent</span>(<span class="string">'http%3A%2F%2Fqinghua.github.io%3Fname%3Dg%20gg'</span>);</div></pre></td></tr></table></figure></p>
<p>在Java里可以用以下语句来完成url的转义：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">URLEncoder.encode(<span class="string">"懒"</span>, <span class="string">"UTF-8"</span>);</div><div class="line">URLDecoder.decode(<span class="string">"%E6%87%92"</span>, <span class="string">"UTF-8"</span>);</div></pre></td></tr></table></figure></p>
<h3 id="XML-amp-YAML-amp-JSON-amp-CSV"><a href="#XML-amp-YAML-amp-JSON-amp-CSV" class="headerlink" title="XML &amp; YAML &amp; JSON &amp; CSV"></a>XML &amp; YAML &amp; JSON &amp; CSV</h3><p>在这些数据格式中，对xml的转义基本上跟html差不多，这里就不再赘述了。对于yaml来说，规则如下：</p>
<ol>
<li>在一个单引号标注的字符串中，一个单引号需要转义成两个单引号</li>
<li>在一个双引号标注的字符串中，大部分符号都需要用反斜杠来转义</li>
<li>如果字符串中有控制字符（如<code>\0</code>、<code>\n</code>等），需要用双引号来标注</li>
<li>如果字符串看起来像下面的样子，需要用引号（无所谓哪种）来标注：<ul>
<li><code>true</code>或<code>false</code></li>
<li><code>null</code>或<code>~</code></li>
<li>看起来像数字，如<code>2</code>，<code>14.9</code>，<code>12e7</code>等</li>
<li>看起来像日期，如<code>2014-12-31</code></li>
</ul>
</li>
</ol>
<p>完整的规则可以参考<a href="http://www.yaml.org/spec/1.2/spec.html#id2776092" target="_blank" rel="external">yaml规范</a>。</p>
<p>对与json来说，需要转义的字符如下图：<br><img src="http://www.json.org/string.gif" alt="json string escape"></p>
<p>对于csv来说，转义的规则只有两条：</p>
<ol>
<li>如果值里有逗号、换行或是双引号，需要用双引号来标注</li>
<li>如果值里有双引号，需要把它转义成两个双引号<code>&quot;&quot;</code></li>
</ol>
<h3 id="Java-amp-NET-amp-JS-amp-SQL"><a href="#Java-amp-NET-amp-JS-amp-SQL" class="headerlink" title="Java &amp; .NET &amp; JS &amp; SQL"></a>Java &amp; .NET &amp; JS &amp; SQL</h3><p>对于大部分的编程语言，例如Java、.NET还有JavaScript，甚至C、GO、Ruby等等来说，通常的转义都是通过反斜杠<code>\</code>来实现的。一般都包括如下几项：</p>
<ul>
<li>退格: <code>\b</code></li>
<li>换行: <code>\n</code></li>
<li>制表符: <code>\t</code></li>
<li>回车: <code>\r</code></li>
<li>换页: <code>\f</code></li>
<li>双引号: <code>\&quot;</code></li>
<li>反斜杠: <code>\\</code></li>
</ul>
<p>不过C和C++支持的16进制<code>\x</code>，在java里不被支持。所以<code>\x61\xd2</code>的这个“懒”字，在java中可以通以下这两个表达式来得到真实的字符：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"\u61d2"</span></div><div class="line"><span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123;(<span class="keyword">byte</span>) <span class="number">0x61</span>, (<span class="keyword">byte</span>) <span class="number">0xd2</span>&#125;, <span class="string">"unicode"</span>)</div></pre></td></tr></table></figure></p>
<p>SQL有些不一样。它从语法层面支持模糊查询，所以即使在完全匹配中使用了<code>%</code>也不需要转义。但是代表字符串的单引号<code>&#39;</code>还是不得不转义成两个单引号<code>&#39;&#39;</code>。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>以上是关于编码和转义的一些常识，<a href="https://www.zhihu.com/question/23374078/answer/69732605#" target="_blank" rel="external">知乎上转的这篇回答</a>，系统地介绍了从ASCII到UTF-8，写得非常赞。平时需要编码和转义的时候，可以使用<a href="http://www.freeformatter.com/" target="_blank" rel="external">这个网站</a>在线转换，也挺方便的。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/development/">development</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/encoding/">encoding</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://qinghua.github.io/encoding-and-escaping/" data-title="程序员常见的编码和转义 | 懒程序员改变世界" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/flyway/" title="轻松上手数据库版本管理工具Flyway">
  <strong>上一篇：</strong><br/>
  <span>
  轻松上手数据库版本管理工具Flyway</span>
</a>
</div>


<div class="next">
<a href="/effective-communication/"  title="人际风格与有效沟通实战">
 <strong>下一篇：</strong><br/> 
 <span>人际风格与有效沟通实战
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="encoding-and-escaping/" data-title="程序员常见的编码和转义" data-url="http://qinghua.github.io/encoding-and-escaping/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编码（encoding）"><span class="toc-number">1.</span> <span class="toc-text">编码（encoding）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ASCII-amp-EASCII-amp-ISO-8859-1"><span class="toc-number">1.1.</span> <span class="toc-text">ASCII & EASCII & ISO-8859-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GB2312-amp-GBK-amp-GB18030-amp-ANSI"><span class="toc-number">1.2.</span> <span class="toc-text">GB2312 & GBK & GB18030 & ANSI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-amp-UTF-8"><span class="toc-number">1.3.</span> <span class="toc-text">Unicode & UTF-8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base64-amp-UTF-7"><span class="toc-number">1.4.</span> <span class="toc-text">base64 & UTF-7</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转义（escaping）"><span class="toc-number">2.</span> <span class="toc-text">转义（escaping）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#html-amp-url"><span class="toc-number">2.1.</span> <span class="toc-text">html & url</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML-amp-YAML-amp-JSON-amp-CSV"><span class="toc-number">2.2.</span> <span class="toc-text">XML & YAML & JSON & CSV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-amp-NET-amp-JS-amp-SQL"><span class="toc-number">2.3.</span> <span class="toc-text">Java & .NET & JS & SQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">3.</span> <span class="toc-text">后记</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/agile/" title="agile">agile<sup>2</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/architecture/" title="architecture">architecture<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/db/" title="db">db<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/development/" title="development">development<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/devops/" title="devops">devops<sup>37</sup></a></li>
		  
		
		  
			<li><a href="/categories/idea/" title="idea">idea<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux-unix/" title="linux/unix">linux/unix<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/tool/" title="tool">tool<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/vr/" title="vr">vr<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/kubernetes/" title="kubernetes">kubernetes<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/mesos/" title="mesos">mesos<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/storage/" title="storage">storage<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/soft-skill/" title="soft skill">soft skill<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/idea/" title="idea">idea<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/IntelliJ-IDEA/" title="IntelliJ IDEA">IntelliJ IDEA<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/ceph/" title="ceph">ceph<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker-registry/" title="docker registry">docker registry<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/dubbo/" title="dubbo">dubbo<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/service-governance/" title="service governance">service governance<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/cloudify/" title="cloudify">cloudify<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/network/" title="network">network<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OCR/" title="OCR">OCR<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/radosgw/" title="radosgw">radosgw<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/start-up/" title="start up">start up<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/openstack-swift/" title="openstack swift">openstack swift<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/book/" title="book">book<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/JGit/" title="JGit">JGit<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      原创作品，转载请注明出处。
      <span id="busuanzi_container_site_pv">
        目前本站总访问量为<span id="busuanzi_value_site_pv"></span>次，
      </span>
      <span id="busuanzi_container_site_uv">
        访客数为<span id="busuanzi_value_site_uv"></span>人次
      </span>
      <br>
      &copy; 2018 Qinghua Gao<br>
      Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
    </div>
  </div>
</footer>
<!--<div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Qinghua Gao in ThoughtWorks. <br/>
			Talk is cheap, show me the example.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/qinghua" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:ggggqh666@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Qinghua Gao">Qinghua Gao</a>
		
		
		</p>
</div>
--></footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"ggggqh666"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4abf71e9841843a04e32d4ca5a41b0b7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
